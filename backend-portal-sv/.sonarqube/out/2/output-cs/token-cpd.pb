ß
pC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Token\TokenService.cs
	namespace 	
Services
 
. 
Services 
{		 
public

 

class

 
TokenService

 
:

 
ITokenService

  -
{ 
private 
readonly 
string 

_secretKey  *
;* +
public 
TokenService 
( 
IConfiguration *
configuration+ 8
)8 9
{ 	

_secretKey 
= 
configuration &
[& '
$str' 3
]3 4
;4 5
} 	
public 
async 
Task 
< 
string  
>  !
GenerateToken" /
(/ 0
)0 1
{ 	
var 
key 
= 
Encoding 
. 
ASCII $
.$ %
GetBytes% -
(- .

_secretKey. 8
)8 9
;9 :
var 
tokenConfig 
= 
new !#
SecurityTokenDescriptor" 9
{ 
Subject 
= 
new 
ClaimsIdentity ,
(, -
new- 0
[0 1
]1 2
{ 
new 
Claim 
( 
$str &
,& '
Guid( ,
., -
NewGuid- 4
(4 5
)5 6
.6 7
ToString7 ?
(? @
)@ A
)A B
,B C
} 
) 
, 
Expires 
= 
DateTime "
." #
UtcNow# )
.) *
AddHours* 2
(2 3
$num3 4
)4 5
,5 6
SigningCredentials "
=# $
new% (
SigningCredentials) ;
(; <
new  
SymmetricSecurityKey ,
(, -
key- 0
)0 1
,1 2
SecurityAlgorithms   &
.  & '
HmacSha256Signature  ' :
)  : ;
}!! 
;!! 
var## 
tokenHandler## 
=## 
new## "#
JwtSecurityTokenHandler### :
(##: ;
)##; <
;##< =
var$$ 
token$$ 
=$$ 
tokenHandler$$ $
.$$$ %
CreateToken$$% 0
($$0 1
tokenConfig$$1 <
)$$< =
;$$= >
return&& 
tokenHandler&& 
.&&  

WriteToken&&  *
(&&* +
token&&+ 0
)&&0 1
;&&1 2
}'' 	
}(( 
})) €
}C:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Token\Interfaces\ITokenServices.cs
	namespace 	
Services
 
. 
Services 
. 

Interfaces &
{ 
public 

	interface 
ITokenService "
{ 
Task 
< 
string 
> 
GenerateToken "
(" #
)# $
;$ %
} 
} Ø+
tC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Cliente\ClienteDTO.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Cliente  '
{ 
public 

class 

ClienteDTO 
{ 
public 

ClienteDTO 
( 
) 
{ 
} 
public		 

ClienteDTO		 
(		 
Domain		  
.		  !
Entity		! '
.		' (
Cliente		( /
cliente		0 7
)		7 8
{

 	
if 
( 
cliente 
== 
null 
)  
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
cliente7 >
)> ?
,? @
$strA _
)_ `
;` a
this 
. 
Id 
= 
cliente 
. 
Id  
;  !
this 
. 
Nome 
= 
cliente 
.  
nome  $
;$ %
this 
. 
Email 
= 
cliente  
.  !
email! &
;& '
this 
. 
Cpf 
= 
cliente 
. 
cpf "
;" #
this 
. 
Telefone 
= 
cliente #
.# $
telefone$ ,
;, -
this 
. 
Sexo 
= 
cliente 
.  
sexo  $
;$ %
this 
. 
Cep 
= 
cliente 
. 
cep "
;" #
this 
. 
DataCriacao 
= 
cliente &
.& '
datacriacao' 2
;2 3
} 	
[ 	
Required	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Required	 
] 
[ 	
	MaxLength	 
( 
$num 
) 
] 
[ 	
	MinLength	 
( 
$num 
) 
] 
public 
string 
Nome 
{ 
get  
;  !
set" %
;% &
}' (
[   	
Required  	 
]   
[!! 	
EmailAddress!!	 
]!! 
public"" 
string"" 
Email"" 
{"" 
get"" !
;""! "
set""# &
;""& '
}""( )
[$$ 	
Required$$	 
]$$ 
[%% 	
StringLength%%	 
(%% 
$num%% 
,%% 
MinimumLength%% '
=%%( )
$num%%* ,
,%%, -
ErrorMessage%%. :
=%%; <
$str%%= j
)%%j k
]%%k l
public&& 
string&& 
Cpf&& 
{&& 
get&& 
;&&  
set&&! $
;&&$ %
}&&& '
[(( 	
Phone((	 
](( 
public)) 
string)) 
Telefone)) 
{))  
get))! $
;))$ %
set))& )
;))) *
}))+ ,
[++ 	
Required++	 
]++ 
[,, 	
RegularExpression,,	 
(,, 
$str,,  
,,,  !
ErrorMessage,," .
=,,/ 0
$str,,1 L
),,L M
],,M N
public-- 
string-- 
Sexo-- 
{-- 
get--  
;--  !
set--" %
;--% &
}--' (
[// 	
Required//	 
]// 
[00 	
StringLength00	 
(00 
$num00 
,00 
MinimumLength00 &
=00' (
$num00) *
,00* +
ErrorMessage00, 8
=009 :
$str00; g
)00g h
]00h i
public11 
string11 
Cep11 
{11 
get11 
;11  
set11! $
;11$ %
}11& '
[33 	
Required33	 
]33 
public44 
DateTime44 
DataCriacao44 #
{44$ %
get44& )
;44) *
set44+ .
;44. /
}440 1
public66 
Domain66 
.66 
Entity66 
.66 
Cliente66 $
ToEntity66% -
(66- .
)66. /
{77 	
return88 
new88 
Domain88 
.88 
Entity88 $
.88$ %
Cliente88% ,
(88, -
this99 
.99 
Id99 
,99 
this:: 
.:: 
Nome:: 
,:: 
this;; 
.;; 
Email;; 
,;; 
this<< 
.<< 
Cpf<< 
,<< 
this== 
.== 
Telefone== 
,== 
this>> 
.>> 
Sexo>> 
,>> 
this?? 
.?? 
Cep?? 
,?? 
this@@ 
.@@ 
DataCriacao@@  
)AA 
;AA 
}BB 	
}CC 
}DD °
rC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Chatbot\UsageDTO.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Chatbot  '
{ 
public 

class 
UsageDTO 
{ 
public 
int 
prompt_tokens  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
completion_tokens $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
int 
total_tokens 
{  !
get" %
;% &
set' *
;* +
}, -
public 
UsageDTO 
( 
) 
{ 
} 
public

 
UsageDTO

 
(

 
int

 
prompt_tokens

 )
,

) *
int

+ .
completion_tokens

/ @
,

@ A
int

B E
total_tokens

F R
)

R S
{ 	
this 
. 
prompt_tokens 
=  
prompt_tokens! .
;. /
this 
. 
completion_tokens "
=# $
completion_tokens% 6
;6 7
this 
. 
total_tokens 
= 
total_tokens  ,
;, -
} 	
} 
} ¶
uC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Chatbot\ResponseDTO.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Chatbot  '
{ 
public 

class 
ResponseDTO 
{ 
public 
string 
? 
@object 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
? 
id 
{ 
get 
;  
set! $
;$ %
}& '
public 
int 
? 
created 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
model 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
string		 
?		 
system_fingerprint		 )
{		* +
get		, /
;		/ 0
set		1 4
;		4 5
}		6 7
public

 
List

 
<

 
	ChoiceDTO

 
>

 
choices

 &
{

' (
get

) ,
;

, -
set

. 1
;

1 2
}

3 4
=

5 6
new

7 :
List

; ?
<

? @
	ChoiceDTO

@ I
>

I J
(

J K
)

K L
;

L M
public 
UsageDTO 
usage 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
new. 1
UsageDTO2 :
(: ;
); <
;< =
} 
} Á
tC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Chatbot\MessageDTO.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Chatbot  '
{ 
public 

class 

MessageDTO 
{ 
public 
string 
? 
role 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
content 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

MessageDTO 
( 
) 
{ 
} 
public		 

MessageDTO		 
(		 
string		  
role		! %
,		% &
string		' -
content		. 5
)		5 6
{

 	
this 
. 
role 
= 
role 
?? 
throw  %
new& )!
ArgumentNullException* ?
(? @
nameof@ F
(F G
roleG K
)K L
)L M
;M N
this 
. 
content 
= 
content "
??# %
throw& +
new, /!
ArgumentNullException0 E
(E F
nameofF L
(L M
contentM T
)T U
)U V
;V W
} 	
} 
} õ
sC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Chatbot\ChoiceDTO.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Chatbot  '
{ 
public 

class 
	ChoiceDTO 
{ 
public 
int 
index 
{ 
get 
; 
set  #
;# $
}% &
public 

MessageDTO 
message !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
new2 5

MessageDTO6 @
(@ A
)A B
;B C
public 
object 
logprobs 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
new/ 2
object3 9
(9 :
): ;
;; <
public		 
string		 
finish_reason		 #
{		$ %
get		& )
;		) *
set		+ .
;		. /
}		0 1
=		2 3
$str		4 6
;		6 7
public 
	ChoiceDTO 
( 
) 
{ 
} 
public 
	ChoiceDTO 
( 
int 
index "
," #

MessageDTO$ .
message/ 6
,6 7
object8 >
logprobs? G
,G H
stringI O
finish_reasonP ]
)] ^
{ 	
this 
. 
index 
= 
index 
; 
this 
. 
message 
= 
message "
??# %
throw& +
new, /!
ArgumentNullException0 E
(E F
nameofF L
(L M
messageM T
)T U
)U V
;V W
this 
. 
logprobs 
= 
logprobs $
??% '
throw( -
new. 1!
ArgumentNullException2 G
(G H
nameofH N
(N O
logprobsO W
)W X
)X Y
;Y Z
this 
. 
finish_reason 
=  
finish_reason! .
??/ 1
throw2 7
new8 ;!
ArgumentNullException< Q
(Q R
nameofR X
(X Y
finish_reasonY f
)f g
)g h
;h i
} 	
} 
} è	
€C:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Cliente\Interfaces\IClienteService.cs
	namespace 	
Services
 
. 
Services 
. 
Cliente #
.# $

Interfaces$ .
{ 
public 

	interface 
IClienteService $
{ 
Task 
Add 
( 

ClienteDTO 
cliente #
)# $
;$ %
Task 
< 
List 
< 

ClienteDTO 
> 
> 
GetAll %
(% &
int& )
numero_pagina* 7
,7 8
int9 <
quantidade_p_pagina= P
)P Q
;Q R
Task		 
Delete		 
(		 

ClienteDTO		 
cliente		 &
)		& '
;		' (
Task

 
Update

 
(

 

ClienteDTO

 
cliente

 &
)

& '
;

' (
Task 
< 

ClienteDTO 
> 
Get 
( 
int  
id! #
)# $
;$ %
} 
} Ý	
C:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Chatbot\Interface\IChatbotService.cs
	namespace 	
Services
 
. 
Services 
. 
Chatbot #
.# $
	Interface$ -
{ 
public 

	interface 
IChatbotService $
{ 
Task 
< 
string 
> 
SendMessage  
(  !
string! '
message( /
)/ 0
;0 1
Task		 
CriaHistorico		 
(		 
ChatDto		 "
chat		# '
)		' (
;		( )
Task

 
AtualizaHistorico

 
(

 
ChatDto

 &
chat

' +
)

+ ,
;

, -
Task 
< 
List 
< 
ChatDto 
> 
> 
PegaHistoricos *
(* +
)+ ,
;, -
Task 
< 
CategoriaConversa 
> 
validateCategoria  1
(1 2
string2 8
resumoConversa9 G
)G H
;H I
} 
} Š)
qC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\DTO\Chatbot\ChatDto.cs
	namespace 	
Services
 
. 
Services 
. 
DTO 
.  
Chatbot  '
{ 
public 

class 
ChatDto 
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public		 
DateTime		 
DataMensagem		 $
{		% &
get		' *
;		* +
set		, /
;		/ 0
}		1 2
=		3 4
DateTime		5 =
.		= >
Now		> A
;		A B
public

 
string

 
?

 
ResumoConversa

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
public 
bool 
ConversaConcluida %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
string 
? 
EmailCliente #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
CategoriaConversa  
	Categoria! *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
=9 :
CategoriaConversa; L
.L M
OutrosM S
;S T
public 
string 
? 

Satisfacao !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
ChatDto 
( 
) 
{ 
} 
public 
ChatDto 
( 
Chat 

chatEntity &
)& '
{( )
if 
( 

chatEntity 
== 
null "
)" #
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7

chatEntity7 A
)A B
,B C
$strD _
)_ `
;` a
this 
. 
Id 
= 

chatEntity  
.  !
Id! #
;# $
this 
. 
DataMensagem 
= 

chatEntity  *
.* +
dataMensagem+ 7
;7 8
this 
. 
ResumoConversa 
=  !

chatEntity" ,
., -
ResumoConversa- ;
;; <
this 
. 
ConversaConcluida "
=# $

chatEntity% /
./ 0
conversaConcluida0 A
;A B
this 
. 
EmailCliente 
= 

chatEntity  *
.* +
EmailCliente+ 7
;7 8
this 
. 
	Categoria 
= 

chatEntity '
.' (
	Categoria( 1
;1 2
this 
. 

Satisfacao 
= 

chatEntity )
.) *

Satisfacao* 4
;4 5
} 	
public   
ChatDto   
(   
Guid   
id   
,   
DateTime    (
dataMensagem  ) 5
,  5 6
string  7 =
resumoConversa  > L
,  L M
bool  N R
conversaConcluida  S d
,  d e
string  f l
emailCliente  m y
,  y z
CategoriaConversa	  { Œ
	categoria
   –
,
  – —
string
  ˜ ž

satisfacao
  Ÿ ©
)
  © ª
{!! 	
Id"" 
="" 
id"" 
;"" 
DataMensagem## 
=## 
dataMensagem## '
;##' (
ResumoConversa$$ 
=$$ 
resumoConversa$$ +
;$$+ ,
ConversaConcluida%% 
=%% 
conversaConcluida%%  1
;%%1 2
EmailCliente&& 
=&& 
emailCliente&& '
;&&' (
	Categoria'' 
='' 
	categoria'' !
;''! "

Satisfacao(( 
=(( 

satisfacao(( #
;((# $
})) 	
public,, 
Chat,, 
ToEntity,, 
(,, 
),, 
{-- 	
return.. 
new.. 
Chat.. 
(.. 
this..  
...  !
Id..! #
,..# $
this// 
.// 
DataMensagem// !
,//! "
this00 
.00 
ResumoConversa00 #
??00$ &
$str00' )
,00) *
this11 
.11 
ConversaConcluida11 &
,11& '
this22 
.22 
EmailCliente22 !
??22" $
$str22% '
,22' (
this33 
.33 
	Categoria33 
,33 
this44 
.44 

Satisfacao44 
??44  "
$str44# %
)44% &
;44& '
}55 	
}66 
}77 ´4
tC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Cliente\ClienteService.cs
	namespace 	
Services
 
. 
Services 
. 
Cliente #
{ 
public 

class 
ClienteService 
:  !
IClienteService" 1
{		 
private

 
readonly

 
IClienteRepository

 +
_clienteRepository

, >
;

> ?
private 
readonly 
ILogger  
_logger! (
;( )
public 
ClienteService 
( 
IClienteRepository 0
clienteRepository1 B
,B C
ILoggerD K
logsL P
)P Q
{ 	
_clienteRepository 
=  
clienteRepository! 2
??3 5
throw6 ;
new< ?!
ArgumentNullException@ U
(U V
nameofV \
(\ ]
clienteRepository] n
)n o
)o p
;p q
_logger 
= 
logs 
?? 
throw #
new$ '!
ArgumentNullException( =
(= >
nameof> D
(D E
logsE I
)I J
)J K
;K L
} 	
public 
async 
Task 
Add 
( 

ClienteDTO (
cliente) 0
)0 1
{ 	
try 
{ 
await 
_clienteRepository (
.( )
Add) ,
(, -
cliente- 4
.4 5
ToEntity5 =
(= >
)> ?
)? @
;@ A
_logger 
. 
Information #
(# $
$str$ S
,S T
clienteU \
.\ ]
Nome] a
)a b
;b c
} 
catch 
( 
	Exception 
e 
) 
{ 
_logger 
. 
Error 
( 
e 
.  
Message  '
,' (
e) *
,* +
$str, _
)_ `
;` a
throw 
; 
} 
} 	
public   
async   
Task   
Delete    
(    !

ClienteDTO  ! +
cliente  , 3
)  3 4
{!! 	
try"" 
{## 
await$$ 
_clienteRepository$$ (
.$$( )
Delete$$) /
($$/ 0
cliente$$0 7
.$$7 8
ToEntity$$8 @
($$@ A
)$$A B
)$$B C
;$$C D
_logger%% 
.%% 
Information%% #
(%%# $
$str%%$ Q
,%%Q R
cliente%%S Z
.%%Z [
Nome%%[ _
)%%_ `
;%%` a
}&& 
catch'' 
('' 
	Exception'' 
e'' 
)'' 
{(( 
_logger)) 
.)) 
Error)) 
()) 
e)) 
.))  
Message))  '
,))' (
e))) *
,))* +
$str)), e
)))e f
;))f g
throw** 
;** 
}++ 
},, 	
public.. 
async.. 
Task.. 
<.. 

ClienteDTO.. $
>..$ %
Get..& )
(..) *
int..* -
id... 0
)..0 1
{// 	
try00 
{11 
var22 
cliente22 
=22 
await22 #
_clienteRepository22$ 6
.226 7
Get227 :
(22: ;
id22; =
)22= >
;22> ?
return33 
new33 

ClienteDTO33 %
(33% &
cliente33& -
)33- .
;33. /
}44 
catch55 
(55 
	Exception55 
e55 
)55 
{66 
_logger77 
.77 
Error77 
(77 
e77 
.77  
Message77  '
,77' (
e77) *
,77* +
$str77, c
)77c d
;77d e
throw88 
;88 
}99 
}:: 	
public<< 
async<< 
Task<< 
<<< 
List<< 
<<< 

ClienteDTO<< )
><<) *
><<* +
GetAll<<, 2
(<<2 3
int<<3 6
numero_pagina<<7 D
,<<D E
int<<F I
quantidade_p_pagina<<J ]
)<<] ^
{== 	
try>> 
{?? 
var@@ 
listaClientes@@ !
=@@" #
await@@$ )
_clienteRepository@@* <
.@@< =
GetAll@@= C
(@@C D
numero_pagina@@D Q
,@@Q R
quantidade_p_pagina@@S f
)@@f g
;@@g h
returnAA 
listaClientesAA $
.AA$ %
SelectAA% +
(AA+ ,
clienteAA, 3
=>AA4 6
newAA7 :

ClienteDTOAA; E
(AAE F
clienteAAF M
)AAM N
)AAN O
.AAO P
ToListAAP V
(AAV W
)AAW X
;AAX Y
}BB 
catchCC 
(CC 
	ExceptionCC 
eCC 
)CC 
{DD 
_loggerEE 
.EE 
ErrorEE 
(EE 
eEE 
.EE  
MessageEE  '
,EE' (
eEE) *
,EE* +
$strEE, k
)EEk l
;EEl m
throwFF 
;FF 
}GG 
}HH 	
publicJJ 
asyncJJ 
TaskJJ 
UpdateJJ  
(JJ  !

ClienteDTOJJ! +
clienteJJ, 3
)JJ3 4
{KK 	
tryLL 
{MM 
awaitNN 
_clienteRepositoryNN (
.NN( )
UpdateNN) /
(NN/ 0
clienteNN0 7
.NN7 8
ToEntityNN8 @
(NN@ A
)NNA B
)NNB C
;NNC D
_loggerOO 
.OO 
InformationOO #
(OO# $
$strOO$ S
,OOS T
clienteOOU \
.OO\ ]
NomeOO] a
)OOa b
;OOb c
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
eQQ 
)QQ 
{RR 
_loggerSS 
.SS 
ErrorSS 
(SS 
eSS 
.SS  
MessageSS  '
,SS' (
eSS) *
,SS* +
$strSS, g
)SSg h
;SSh i
throwTT 
;TT 
}UU 
}VV 	
}WW 
}XX Ñ6
tC:\Users\ifspn\OneDrive\Desktop\APPS\backend-portal-sv\backend-portal-sv\Services\Services\Chatbot\ChatbotService.cs
	namespace 	
Services
 
. 
Services 
. 
Chatbot #
{ 
public		 

class		 
ChatbotService		 
:		  !
IChatbotService		" 1
{

 
private 
readonly 
IChatbotRepository +
_chatbotRepository, >
;> ?
private 
readonly 
ILogger  
_logger! (
;( )
public 
ChatbotService 
( 
IChatbotRepository 0
chatbotRepository1 B
,B C
ILoggerD K
loggerL R
)R S
{ 	
_logger 
= 
logger 
; 
_chatbotRepository 
=  
chatbotRepository! 2
??3 5
throw6 ;
new< ?!
ArgumentNullException@ U
(U V
nameofV \
(\ ]
chatbotRepository] n
)n o
)o p
;p q
} 	
public 
async 
Task 
AtualizaHistorico +
(+ ,
ChatDto, 3
chat4 8
)8 9
{ 	
try 
{ 
await 
_chatbotRepository (
.( )
AtualizaHistorico) :
(: ;
chat; ?
.? @
ToEntity@ H
(H I
)I J
)J K
;K L
} 
catch 
( 
	Exception 
e 
) 
{ 
_logger 
. 
Error 
( 
e 
,  
$str! Z
,Z [
chat\ `
.` a
Ida c
)c d
;d e
throw 
; 
} 
} 	
public   
async   
Task   
CriaHistorico   '
(  ' (
ChatDto  ( /
chat  0 4
)  4 5
{!! 	
try"" 
{## 
var$$ 

chatEntity$$ 
=$$  
chat$$! %
.$$% &
ToEntity$$& .
($$. /
)$$/ 0
;$$0 1
await%% 
_chatbotRepository%% (
.%%( )
CriaHistorico%%) 6
(%%6 7

chatEntity%%7 A
)%%A B
;%%B C

chatEntity'' 
.'' 
AtualizarCategoria'' -
(''- .
await''. 3
validateCategoria''4 E
(''E F
chat''F J
.''J K
ResumoConversa''K Y
??''Z \
$str''] _
)''_ `
)''` a
;''a b
await(( 
_chatbotRepository(( (
.((( )
AtualizaHistorico(() :
(((: ;

chatEntity((; E
)((E F
;((F G
})) 
catch** 
(** 
	Exception** 
e** 
)** 
{++ 
_logger,, 
.,, 
Error,, 
(,, 
e,, 
,,,  
$str,,! V
,,,V W
chat,,X \
.,,\ ]
ToEntity,,] e
(,,e f
),,f g
),,g h
;,,h i
throw-- 
;-- 
}.. 
}// 	
public11 
async11 
Task11 
<11 
CategoriaConversa11 +
>11+ ,
validateCategoria11- >
(11> ?
string11? E
resumoConversa11F T
)11T U
{22 	
try33 
{44 
if55 
(55 
String55 
.55 
IsNullOrEmpty55 (
(55( )
resumoConversa55) 7
)557 8
)558 9
throw66 
new66 !
ArgumentNullException66 3
(663 4
nameof664 :
(66: ;
resumoConversa66; I
)66I J
,66J K
$str66L ~
)66~ 
;	66 €
return88 
(88 
CategoriaConversa88 )
)88) *
await88* /
_chatbotRepository880 B
.88B C!
validaCategoriaComLLM88C X
(88X Y
resumoConversa88Y g
)88g h
;88h i
}99 
catch:: 
(:: 
	Exception:: 
e:: 
):: 
{;; 
_logger<< 
.<< 
Error<< 
(<< 
e<< 
,<<  
$str<<! \
,<<\ ]
resumoConversa<<^ l
)<<l m
;<<m n
throw== 
;== 
}>> 
}?? 	
publicAA 
asyncAA 
TaskAA 
<AA 
ListAA 
<AA 
ChatDtoAA &
>AA& '
>AA' (
PegaHistoricosAA) 7
(AA7 8
)AA8 9
{BB 	
tryCC 
{DD 
varEE 
chatlistEE 
=EE 
newEE "
ListEE# '
<EE' (
ChatDtoEE( /
>EE/ 0
(EE0 1
)EE1 2
;EE2 3
varFF 
listChatEntityFF "
=FF# $
awaitFF% *
_chatbotRepositoryFF+ =
.FF= >
PegaHistoricosFF> L
(FFL M
)FFM N
;FFN O
foreachGG 
(GG 
varGG 
itemGG !
inGG" $
listChatEntityGG% 3
)GG3 4
chatlistHH 
.HH 
AddHH  
(HH  !
newHH! $
ChatDtoHH% ,
(HH, -
itemHH- 1
)HH1 2
)HH2 3
;HH3 4
returnJJ 
chatlistJJ 
;JJ  
}LL 
catchMM 
(MM 
	ExceptionMM 
eMM 
)MM 
{NN 
_loggerOO 
.OO 
ErrorOO 
(OO 
eOO 
,OO  
$strOO! E
)OOE F
;OOF G
throwPP 
;PP 
}QQ 
}RR 	
publicTT 
asyncTT 
TaskTT 
<TT 
stringTT  
>TT  !
SendMessageTT" -
(TT- .
stringTT. 4
messageTT5 <
)TT< =
{UU 	
tryVV 
{WW 
varXX  
returnMessageFromApiXX (
=XX) *
awaitXX+ 0
_chatbotRepositoryXX1 C
.XXC D
SendMessageAsyncXXD T
(XXT U
messageXXU \
)XX\ ]
;XX] ^
returnYY  
returnMessageFromApiYY +
;YY+ ,
}ZZ 
catch[[ 
([[ 
	Exception[[ 
e[[ 
)[[ 
{\\ 
_logger^^ 
.^^ 
Error^^ 
(^^ 
e^^ 
,^^  
$str^^! M
,^^M N
message^^O V
)^^V W
;^^W X
throw__ 
;__ 
}`` 
}aa 	
}bb 
}cc 